from bs4 import BeautifulSoup as BS
import os

"""
~~~~~~~~~~~TO_DO_LIST~~~~~~~~~~~
1. Read file "evilcorp.html"
2. Modify <title>: "Evil Corp - Stealing your money every day"
3. Take name (class_name->class_pronoun) and add new tag to body
	<h1>Mr. Alderson, you are hacked!</h1>
4. Add subject script (HTML_DOC) into <body>
5. Change URL on "https://mrrobot.fandom.com/wiki/Fsociety"
6. Create new HTML "evilcorp_hacked.html" with all this changes
	and put it in the same directory as the original
"""

HTML_SCRIPT = """
		hacked = function() {
			alert('hacked');
		}
		window.addEventListener('load', 
		function() { 
			var f = document.querySelector("form");
			f.setAttribute("onsubmit", "hacked()");
		},
		false
		);
"""

class hackFunctional:

	def __init__(self, html_path):
		self.html_path = html_path
		self.ret_html_path = "../../materials/evilcorp_hacked.html"
		self.soup = self.openComingHtml()

	def openComingHtml(self):
		base = os.path.dirname(os.path.abspath(__file__))
		html = open(os.path.join(base, self.html_path))
		return BS(html, "html.parser")
	
	def changeTitle(self):
		changed_text = self.soup.find("title", {"id":None})
		changed_text.replace_with(
			"Evil Corp - Stealing your money every day")

	def newHeader(self):
		found_name = self.soup.p.span.text
		adding_str = found_name + ", you are hacked!"
		tag = self.soup.new_tag("h1")
		self.soup.body.append(tag)
		self.soup.body.h1.append(adding_str)
	
	def appondScript(self):
		tag = self.soup.new_tag("script")
		self.soup.body.append(tag)
		self.soup.body.script.append(HTML_SCRIPT)
	
	def changeURL(self):
		self.soup.find("a", href=True)[
			"href"] = "https://mrrobot.fandom.com/wiki/Fsociety"
	
	def createNewHTML(self):
		with open(self.ret_html_path, "wb") as f_output:
			f_output.write(self.soup.prettify("utf-8"))

class letsHackRichGuys:

	def __init__(self, html_path):
		hack = hackFunctional(html_path)
		hack.changeTitle()
		hack.newHeader()
		hack.appondScript()
		hack.changeURL()
		hack.createNewHTML()